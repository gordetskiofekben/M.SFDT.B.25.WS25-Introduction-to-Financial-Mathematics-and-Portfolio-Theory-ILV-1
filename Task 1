# importing Panda library
import pandas as pd

# importing csv file
CSV = "dataset_multistock_final.csv"

# setting time horizons as list
Horizons = [1, 3]

#setting end of observation
END = pd.Timestamp("2025-12-31")

# reading out the csv file and setting dataframes
df = pd.read_csv(CSV, usecols=["Date", "Ticker", "Close"])
df["Date"] = pd.to_datetime(df["Date"])

# converting closing prices to floats for later calculations
df["Close"] = pd.to_numeric(df["Close"], errors="coerce")

# creating a list where the results will be appended
rows = []

# t...Ticker - grouping by Ticker
for t, g in df.groupby("Ticker"):
    
# g...loop to only observe data from a specific Ticker t    
    g = g[g["Date"] <= END]
    if g.empty: continue
    end_p = g.iloc[-1]["Close"]
    
# computing of the annualized rate of returns for time horizons 1 year and 3 years
    for h in Horizons:
        s = g[g["Date"] <= END - pd.DateOffset(years=h)]
        if s.empty: continue
        start_p = s.iloc[-1]["Close"]
        r = end_p / start_p
        
# appends results to list rows containing Ticker, time horizon, start price, end price, total return in % and annual return in %
        rows.append([t, len(range(h)), start_p, end_p, 100*(r-1), 100*(r**(1/h)-1)])

# prepares the output and converts list rows into readable column names
output = pd.DataFrame(rows, columns=["Ticker","Years","StartPrice","EndPrice","TotalRet in %","AnnualRet in %"])

# generates the output (index=False removes the index column)
print(output.to_string(index=False, float_format=lambda x: f"{x:,.4f}"))
